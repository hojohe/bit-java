package kr.co.mini5.user.servlet;

import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import kr.co.mini5.user.dao.UserDAO;
import kr.co.mini5.vo.UserVO;

@WebServlet("/userSignUp/userSignUp")
public class UserSignUpServlet extends HttpServlet{
	
	UserDAO dao = new UserDAO();
	
	@Override
	public void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

		request.setCharacterEncoding("utf-8");

		UserVO param = new UserVO();
		
		/* UserSingUp.jsp 파일에서 <form> 태그로 넘겨준 값들 (id, pass, nickName)*/
		String id = request.getParameter("id");
		String pass = request.getParameter("pass");
		String nickName = request.getParameter("nickName");
	
		/**/
		String dbUserId = dao.selectUserIdList(id);
		
		if(id.equals(dbUserId)) {
			request.setAttribute("msg", "아이디가 중복됩니다.");
			response.sendRedirect(request.getContextPath()+"/jsp/main/main2.jsp");
			
		} else {
			param.setId(id);
			param.setPass(pass);
			param.setNickName(nickName);
			
			// 회원가입
			int userNo = dao.insertUser(param);
			
			// 회원가입 한 사용자 정보 조회
			UserVO user = dao.selectSignUp(userNo);
			request.setAttribute("user", user);
			response.sendRedirect(request.getContextPath()+"/jsp/main/main2.jsp?user=" + user);
		}
		
		
	}
		
}
