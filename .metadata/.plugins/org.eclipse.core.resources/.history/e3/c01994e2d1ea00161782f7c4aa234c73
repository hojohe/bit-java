<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="kr.co.mini5.detail.dao.DetailDAO">

	<resultMap type="detail" id="detailMap">
		<result column="detail_no" property="detailNo" />
		<result column="feed_no" property="feedNo" />
		<result column="user_no" property="userNo" />
		<result column="days" property="days" />
		<result column="percent" property="percent" />
		<result column="end_date" property="endDate" />
		<result column="feed_dday" property="feedDday" />
	</resultMap>
	
	<select id="selectDetail" parameterType="detail" resultMap="detailMap">
		select detail_no,
			   feed_no,
			   user_no,
			   days,
			   percent
		  from t_feed_detail
		 where feed_no = #{feedNo}
		   and user_no = #{userNo}
		 order by days desc
	</select>
	
		
	<select id="selectOneDetail" parameterType="int" resultMap="detailMap">
		select feed_no,
		       end_date,
		       feed_dday
		  from (
		  	select d.feed_no,
		 	       f.end_date,
		 	       f.feed_dday
		   	  from t_feed_detail d, t_feed f
		  	 where d.feed_no = f.feed_no
		  	   and d.user_no = f.user_no
		  	   and d.user_no = #{userNo}
			order by days
		)
		where rownum = 1
	</select>
	
	<update id="updateDetail" parameterType="detail">
		update t_feed_detail
		   set percent = #{percent}
		  
	
	</update>

</mapper> 